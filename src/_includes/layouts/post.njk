{% extends "layouts/base.njk" %}
{% block content %}
  <main class="w-full mx-auto flex flex-grow flex-col post-content">
    {% include "components/header.njk" %}
    <section class="items-center mb-6 gap-5 max-w-6xl mx-auto px-5 w-full">
      <h1>{{ title }}</h1>
      <div class="text-sm text-gray-600 my-5 flex flex-col lg:flex-row gap-3 dark:text-gray-200 border-b border-b-gray-600 dark:border-b-gray-200 pb-8">
        <date class="slash" datetime="{{ page.date | htmlDateString }}">{{ page.date | readableDate }}</date>
        <span class="slash">{{ content | readtime }}</span>
        <span class="slash">
          {%- for tag in tags | filterTagList -%}
            {%- set tagUrl %}/tags/{{ tag | slug }}/{% endset -%}
            <span><span class="text-teal-600 dark:text-teal-400">#</span><a href="{{ tagUrl | url }}">{{ tag }}</a></span>
          {%- endfor %}
        </span>
      </div>
      <div id="accordionGroup" class="accordion">
        <h2>
          <button type="button" aria-expanded="false" class="accordion-trigger" aria-controls="sect1" id="accordion1id">
            <span class="accordion-title">
              What's Inside
              <span class="accordion-icon"></span>
            </span>
          </button>
        </h2>
        <div id="sect1" role="region" aria-labelledby="accordion1id" class="accordion-panel" hidden="">
          <aside class="toc-container">
            {{ content | toc | safe }}
          </aside>
        </div>
      </div>
      <article>
        {{ content | safe }}
      </article>
      <a target="_blank" class="text-teal-700 dark:text-teal-400 mt-4 inline-block" rel="noopener noreferrer" href="https://github.com/learnwithgurpreet/learnwithgurpreet/blob/main/src/posts/{{ page.fileSlug }}.md">Edit post</a>
    </section>

    {% set nextPost = collections.posts | getNextCollectionItem(page) %}
    {% set previousPost = collections.posts | getPreviousCollectionItem(page) %}
    <section class="gap-1 p-1 my-5 lg:my-8 flex flex-col lg:flex-row justify-center lg:justify-between mx-5">
      {% if previousPost %}
        <a class="flex-col items-start justify-center no-decoration" href="{{ previousPost.url | url }}">
          <span class="text-sm uppercase">← Previous</span>
          <h3>{{ previousPost.data.title }}</h3>
        </a>
      {% endif %}
      {% if nextPost %}
        <a class="flex-col items-end justify-center text-right no-decoration" href="{{ nextPost.url | url }}">
          <span class="text-sm uppercase">Next →</span>
          <h3>{{ nextPost.data.title }}</h3>
        </a>
      {% endif %}
    </section>
  </main>
  {% include "components/footer.njk" %}
  <script>
    'use strict';
    class Accordion {
      constructor(domNode) {
        this.rootEl = domNode;
        this.buttonEl = this.rootEl.querySelector('button[aria-expanded]');

        const controlsId = this.buttonEl.getAttribute('aria-controls');
        this.contentEl = document.getElementById(controlsId);

        this.open = this.buttonEl.getAttribute('aria-expanded') === 'true';

        // add event listeners
        this.buttonEl.addEventListener('click', this.onButtonClick.bind(this));
      }

      onButtonClick() {
        this.toggle(!this.open);
      }

      toggle(open) {
        // don't do anything if the open state doesn't change
        if (open === this.open) {
          return;
        }

        // update the internal state
        this.open = open;

        // handle DOM updates
        this.buttonEl.setAttribute('aria-expanded', `${open}`);
        if (open) {
          this.contentEl.removeAttribute('hidden');
        } else {
          this.contentEl.setAttribute('hidden', '');
        }
      }

      // Add public open and close methods for convenience
      open() {
        this.toggle(true);
      }

      close() {
        this.toggle(false);
      }
    }

    // init accordion
    const accordionEl = document.querySelector('.accordion h2');
    new Accordion(accordionEl);
  </script>
{% endblock %}

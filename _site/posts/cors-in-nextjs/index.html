<!doctype html><html lang="en"><head><meta charset="utf-8"><link rel="shortcut icon" href="/assets/favicons/favicon.ico"><link rel="icon" type="image/png" href="/assets/favicons/favicon-32x32.png" sizes="32x32"><link rel="icon" type="image/png" href="/assets/favicons/android-chrome-192x192.png" sizes="192x192"><link rel="icon" type="image/png" href="/assets/favicons/android-chrome-512x512.png" sizes="512x512"><link rel="apple-touch-icon" href="/assets/favicons/apple-touch-icon.png"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="color-scheme" content="light dark"><meta name="msapplication-TileColor" content="#F9FAFB"><meta name="theme-color" content="#F9FAFB"><title>Learn with Gurpreet - CORS in NextJS</title><meta name="keywords" content="cors error in next js, cors error nextjs api, cors in next js, cors issue in next js, cors issue in nextjs code, cors issue in nextjs config, cors issue in nextjs example, cors issue in nextjs fetch, cors issue in nextjs fix, cors issue in nextjs header, cors issue in nextjs middleware, cors issue in nextjs page, how to fix cors issue, next cors error, next js cross origin,"><meta name="description" content="Setting up CORS is always a challenge for people who are not really from server-side application backgrounds. Luckily it wasn’t the case for me, but Vercel."><meta name="og:image" content="https://learnwithgurpreet.com/assets/images/next-and-cors.webp"><meta name="og:title" content="Learn with Gurpreet - CORS in NextJS"><meta name="og:description" content="Setting up CORS is always a challenge for people who are not really from server-side application backgrounds. Luckily it wasn’t the case for me, but Vercel."><meta name="og:url" content="https://learnwithgurpreet.com/posts/cors-in-nextjs/"><meta name="og:site_name" content="Learn with Gurpreet"><meta name="og:locale" content="en_GB"><meta name="og:type" content="article"><meta name="twitter:title" content="Learn with Gurpreet - CORS in NextJS"><meta name="twitter:card" content="summary_large_image"><meta name="twitter:description" content="Setting up CORS is always a challenge for people who are not really from server-side application backgrounds. Luckily it wasn’t the case for me, but Vercel."><meta name="twitter:image" content="https://learnwithgurpreet.com/assets/images/next-and-cors.webp"><meta name="generator" content="Eleventy v2.0.1"><meta itemprop="name" content="Learn with Gurpreet - CORS in NextJS"><meta itemprop="description" content="Setting up CORS is always a challenge for people who are not really from server-side application backgrounds. Luckily it wasn’t the case for me, but Vercel."><link rel="stylesheet" href="/assets/css/styles.css?v=1681830158608"><link rel="alternate" href="https://learnwithgurpreet.com/feed/feed.xml" type="application/atom+xml" title="gS"><link rel="alternate" href="https://learnwithgurpreet.com/feed/feed.json" type="application/json" title="gS"><script>const prefDark = window.matchMedia('(prefers-color-scheme: dark)');
      document
        .querySelector('meta[name="theme-color"]')
        .setAttribute('content', prefDark ? '#111827' : '#F9FAFB');
      document
        .querySelector('meta[name="msapplication-TileColor"]')
        .setAttribute('content', prefDark ? '#111827' : '#F9FAFB');</script></head><body><main class="w-full mx-auto flex flex-grow flex-col post-content"><header class="flex flex-col my-5 max-w-7xl mx-auto w-full px-5"><div class="flex justify-between items-center gap-5 flex-col sm:flex-row mb-4 lg:mb-11"><a class="block font-semibold text-3xl text-teal-600 dark:text-teal-500" href="/">gS</a><nav><div class="fade flex gap-4 flex-wrap items-start justify-start"><a class="underline" href="/posts/">Posts</a> <a class="underline" href="/tags/">Tags</a> <a class="underline" href="/contact/">Contact</a> <a class="underline" href="/uses/">Uses</a> <a class="underline" href="/feed/feed.xml">RSS</a></div></nav></div></header><section class="items-center mb-6 gap-5 max-w-6xl mx-auto px-5 w-full"><h1>CORS in NextJS</h1><div class="text-sm text-gray-600 my-5 flex flex-col lg:flex-row gap-3 dark:text-gray-200 border-b border-b-gray-600 dark:border-b-gray-200 pb-8"><date class="slash" datetime="2021-07-19">Jul 19, 2021</date><span class="slash">4 min read</span> <span class="slash"><span><span class="text-teal-600 dark:text-teal-400">#</span><a href="/tags/programming/">programming</a></span></span></div><picture><source type="image/jpeg" srcset="/assets/images/mU7oCYVJgU-learwithgurpreet-400w.jpeg 400w, /assets/images/mU7oCYVJgU-learwithgurpreet-640w.jpeg 640w" sizes="100vw"><source type="image/webp" srcset="/assets/images/mU7oCYVJgU-learwithgurpreet-400w.webp 400w, /assets/images/mU7oCYVJgU-learwithgurpreet-640w.webp 640w" sizes="100vw"><img alt="featured" loading="lazy" decoding="async" class="featured-image" src="/assets/images/mU7oCYVJgU-learwithgurpreet-400w.jpeg" width="640" height="336"></picture><p class="text-center text-sm text-gray-600 dark:text-gray-200"></p><h2>What's Inside</h2><aside class="my-8 toc-container"><nav class="toc"><ol><li><a href="#how-to-setup-nextjs-api">How to setup NextJS API</a></li><li><a href="#mongodb-setup">MongoDB setup</a></li><li><a href="#run-next.js-in-development-mode">Run Next.js in development mode</a></li><li><a href="#cors-setup">CORS setup</a></li></ol></nav></aside><article><p>Setting up CORS is always a challenge for people who are not really from server-side application backgrounds. Luckily it wasn’t the case for me, but <a href="https://vercel.com/">Vercel</a>.</p><p>I have a couple of projects on Vercel where I can host client-side applications built on ReactJS, NextJS, Gatsby, etc. Recently I found you can host <a href="https://vercel.com/docs/serverless-functions/introduction">serverless</a> functions on Vercel as well.</p><p>These serverless functions are nothing but open up NodeJS server-side script access. You can create a server and run it on Vercel as well as send emails and whatnot.</p><h2 id="how-to-setup-nextjs-api" tabindex="-1"><a class="direct-link" href="#how-to-setup-nextjs-api"><span>How to setup NextJS API</span></a></h2><pre class="language-bash"><code class="language-bash">npx create-next-app --example with-mongodb with-mongodb-app<br><span class="token comment"># or</span><br><span class="token function">yarn</span> create next-app --example with-mongodb with-mongodb-app</code></pre><blockquote><p>Example from <a href="https://github.com/vercel/next.js/tree/canary/examples/with-mongodb">with-mongodb</a></p></blockquote><p>In the above command, you will get the NextJS project set up inside <code>with-mongodb-app</code> directory.</p><p>Now we have our application ready, it’s time to set up the MongoDB instance.</p><p>You can use <a href="https://mongodb.com/atlas">mongodb.com</a> to set up a free account with limited space.</p><h2 id="mongodb-setup" tabindex="-1"><a class="direct-link" href="#mongodb-setup"><span>MongoDB setup</span></a></h2><p>Once you have your MongoDB instance ready, feel free to rename and edit <code>env.local.example</code> to&nbsp;<code>.env.local</code></p><p>Set each variable on <code>.env.local</code>:</p><ul><li><code>MONGODB_URI</code> - Your MongoDB connection string. If you are using <a href="https://mongodb.com/atlas">MongoDB Atlas</a> you can find this by clicking the “Connect” button for your cluster.</li><li><code>MONGODB_DB</code> - The name of the MongoDB database you want to use.</li></ul><h2 id="run-next.js-in-development-mode" tabindex="-1"><a class="direct-link" href="#run-next.js-in-development-mode"><span>Run Next.js in development mode</span></a></h2><pre class="language-bash"><code class="language-bash"><span class="token function">npm</span> <span class="token function">install</span><br><span class="token function">npm</span> run dev<br><br><span class="token comment"># or</span><br><br><span class="token function">yarn</span> <span class="token function">install</span><br><span class="token function">yarn</span> dev</code></pre><p>The application should be up and running on <a href="http://localhost:3000"></a><a href="http://localhost:3000">http://localhost:3000</a></p><h2 id="cors-setup" tabindex="-1"><a class="direct-link" href="#cors-setup"><span>CORS setup</span></a></h2><p>After setting up the database and server, now it’s time to set CORS settings.</p><p>Create <code>vercel.json</code> under the root folder.</p><pre class="language-bash"><code class="language-bash"><span class="token punctuation">{</span><br>  <span class="token string">"headers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><br>    <span class="token punctuation">{</span><br>      <span class="token string">"source"</span><span class="token builtin class-name">:</span> <span class="token string">"/api/(.*)"</span>,<br>      <span class="token string">"headers"</span><span class="token builtin class-name">:</span> <span class="token punctuation">[</span><br>        <span class="token punctuation">{</span> <span class="token string">"key"</span><span class="token builtin class-name">:</span> <span class="token string">"Access-Control-Allow-Credentials"</span>, <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"true"</span> <span class="token punctuation">}</span>,<br>        <span class="token punctuation">{</span> <span class="token string">"key"</span><span class="token builtin class-name">:</span> <span class="token string">"Access-Control-Allow-Origin"</span>, <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"*"</span> <span class="token punctuation">}</span>, // Change this to specific domain <span class="token keyword">for</span> better security<br>        <span class="token punctuation">{</span><br>          <span class="token string">"key"</span><span class="token builtin class-name">:</span> <span class="token string">"Access-Control-Allow-Methods"</span>,<br>          <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"GET,OPTIONS,PATCH,DELETE,POST,PUT"</span><br>        <span class="token punctuation">}</span>,<br>        <span class="token punctuation">{</span><br>          <span class="token string">"key"</span><span class="token builtin class-name">:</span> <span class="token string">"Access-Control-Allow-Headers"</span>,<br>          <span class="token string">"value"</span><span class="token builtin class-name">:</span> <span class="token string">"X-CSRF-Token, X-Requested-With, Accept, Accept-Version, Content-Length, Content-MD5, Content-Type, Date, X-Api-Version"</span><br>        <span class="token punctuation">}</span><br>      <span class="token punctuation">]</span><br>    <span class="token punctuation">}</span><br>  <span class="token punctuation">]</span><br><span class="token punctuation">}</span></code></pre><p>The above change will work for <code>GET</code> requests but you will face problems while making <code>PUT</code> and <code>POST</code> requests. For this, we need to make one more change.</p><p>Go to <code>/api/index.js</code> file.</p><pre class="language-bash"><code class="language-bash"><span class="token builtin class-name">export</span> default async <span class="token punctuation">(</span>req, res<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">&gt;</span> <span class="token punctuation">{</span><br>  const <span class="token punctuation">{</span> method <span class="token punctuation">}</span> <span class="token operator">=</span> req<br><br>  // This will allow OPTIONS request<br>  <span class="token keyword">if</span> <span class="token punctuation">(</span>method <span class="token operator">==</span><span class="token operator">=</span> <span class="token string">"OPTIONS"</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token builtin class-name">return</span> res.status<span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span>.send<span class="token punctuation">(</span><span class="token string">"ok"</span><span class="token punctuation">)</span><br>  <span class="token punctuation">}</span><br><span class="token punctuation">}</span></code></pre></article><a target="_blank" class="text-teal-700 dark:text-teal-400 mt-4 inline-block" rel="noopener noreferrer" href="https://github.com/learnwithgurpreet/learnwithgurpreet/blob/main/src/posts/cors-in-nextjs.md">Edit post</a></section><section class="gap-1 p-1 my-5 lg:my-8 flex flex-col lg:flex-row justify-center lg:justify-between mx-5"><a class="flex-col items-start justify-center no-decoration" href="/posts/github-copilot-future-of-programming/"><span class="text-sm uppercase">← Previous</span><h3>GitHub Copilot - Future of Programming?</h3></a><a class="flex-col items-end justify-center text-right no-decoration" href="/posts/i-dont-know-javascript-but-reactjs/"><span class="text-sm uppercase">Next →</span><h3>I don't know JavaScript but ReactJS</h3></a></section></main><footer class="w-full bg-gray-700 border-t-4 border-teal-600 text-gray-50 flex justify-between text-sm p-4"><span class="italic flex-grow">©2023 Gurpreet Singh</span><nav class="flex gap-2"><a rel="me" class="text-gray-50 underline" href="https://mastodon.social/@gsin" title="Link to my Mastodon page">mastodon</a> <a rel="me" class="text-gray-50 underline" href="https://github.com/learnwithgurpreet" title="Link to my Github page">github</a> <a rel="me" class="text-gray-50 underline" href="/feed/feed.xml" title="Link to my RSS feed">RSS</a></nav></footer></body></html>